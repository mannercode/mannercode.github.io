
-  도메인을 상속해서 dto를 만들지 마라. controller에서 직접 조립해라. 431p데이터 전송 객체는 연결 양쪽에 배포되므로 도메인 객체와 연결하는 방법을 알 필요가 없다. 띠라서 데이터 전송 객체가 도메인 객체에 의존하는 것은 바람직하지 않다. 또한 인터페이스 형식을 변경하면 데이터 전송 객체의 구조도 변경되므 로 도메인 객체가 데이터 전송 객체에 의존히는 것도 좋지 않다. 일반적으로 도메인 모댈은 외 부 인터페이스에 대해 독립적으로유지하는 것이 좋다. 따라서 도메인 모델로부터 데이터 전송 객체를 생성하고 데이터 전송 객체로부터 모델을 업데 이트히는 별도의 어셈블러 객체를 만드는 것이 좋다(그림 15.4). 어셈블러는 데이터 전송 객체 와 도메인 객체를 매핑한다는 점에서 일종의 매퍼(500)에 해당한다.
-
- 데이터 전송객체의 다른일반적인용도는다른계층의 다OJ=한컴포넌트를위한공용데이터 원 본으로 작동하게 하는 것이다. 각 컴포넌트는 데이터 전송 객체를 조금씩 변경하고 다음 계층으 로 전달한다.
-
- DTO는 서비스에서 생성한다. url 등 controller의 정보가 필요하다면 controller가 전달하거나 후처리 한다.
- DTO에서 model을 만들 때는 id만 사용한다. 책에서는 실제 데이터를 기반으로 생성했다. 혹은 클라이언트가 dto를 받으면 그대로 사용하거나 view model로 변경한다. 서버의 도메인 모델로 복구하지는 않는다.
- 낙관적 검사에 버전 번호 대신 수정 타임스댐프를 시용하려는 것은 좋 지 않은생각이다. 시스댐 클록은신뢰할수 없으며 특히 여러 서버 간에 작업을조율하는경우 더욱신뢰하기 어렵다.
- 예매 시스템에서 465p 굵은입자잠금 혹은 집합체 잠금을 구현해 보자
- 게이트웨이,맵퍼, 레지스트리 등 용어 통일하자
- Entity  객체 생성하고 id, create,version 등을 정의한다.
- 작업단위 도입을 고려하자
-

- tdd로 처음 작성한 코드는 코드가 강하게 결합된 상태다. 즉, 하나의 계층에 여러 모듈로 나뉜 것이다. 이 상태에서는 최초의 인터페이스를 제공하는   모듈에 대해서 테스트 하는 것이 맞다. 그러나 리팩토링을 거치면서 여러 레이어로 나뉘게 되면 테스트도 세분화 되어야 한다. 물론, 이것은 리팩토링이기 때문에 최초 작성한 테스트가 변경되어서는 안 된다.
-

entity의 id에 대해서 ddd 97p 참고
eric evans는 고유속성을 조합해서 사용하도록 했다. 그러나 고유속성은 불변인가? 전화번호나 이메일은 변경 가능하다. 주민번호를 id로 하는가?
주민번호가 없는 경우도 있다. 이런 이유로 나는 entity의 id는 guid를 사용한다. 그럼에도 불구하고 주민번호가 도메인 모델의 이치에 맞기는 하다.
aggregate root는 id로 한다. root의 entity는 조합해서 사용한다.
aggregate root는 말 그대로 최상위이다. aggregate root의 속성으로 검색해서 가져오는 것이 맞다.
aggregate root의 속성을 조합해서 id를 만들어도 외부의 entity는 그 규칙을 알 수 없기 때문에 소용이 없다.
———————————
만 이러한 기술적인 문제를 단순화하는 프레임워크를 사용하더라도 다음과 같은 근본적 인 문제가 남는다. 두 객체가 개념적으로 동일한 ENTITY를 니 타내는지 어떻게 알 수 있는기-? 식 별성에 대한 정의는 모델로부터 나온다. 따라서 식별성을 정의하려면 도메인을 이해해야 한다.
때때로 어떤 데이터 속성이니 여러 속성의 조합이 시스템 내에서 유일함을 보장받거니- 단순히 유일하도록 제약되기도 한다. 이 같은 접근법의 결과로 ENTITY는 고유한 키를 제공받는다. 일 간지를예로들면각신문은제목과도시，발행일로구분할수있을것이다 (그러나특별호니-이 름이 바뀌는 경우에 주의해야 한다!)
———————————

동시저장 문제 해결하자
DDD 137p와 엔터아키텍처 어딘가에 있다.


bitcoin, coinbase 등 외부의 요소들에 할당하는 ID는 guid 말고 각각 의미를 알 수 있도록 직접 지정해라.
guid는 내부에서 생성되는 데이터에 대해서 적용한다.

O) coinId=‘bitcoin’
X) coinId=‘0xabcdef’
